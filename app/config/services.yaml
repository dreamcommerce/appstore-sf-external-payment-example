services:
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # Exception handling configuration
    App\Exception\Handler\ValidationExceptionHandler:
        arguments:
            $environment: '%kernel.environment%'
        tags:
            - { name: 'app.exception_handler', priority: 200 }

    App\Exception\Handler\ApiExceptionHandler:
        arguments:
            $environment: '%kernel.environment%'
        tags:
            - { name: 'app.exception_handler', priority: 150 }

    App\Exception\Handler\HttpExceptionHandler:
        arguments:
            $environment: '%kernel.environment%'
        tags:
            - { name: 'app.exception_handler', priority: 100 }

    App\Exception\Handler\GenericExceptionHandler:
        arguments:
            $environment: '%kernel.environment%'
        tags:
            - { name: 'app.exception_handler', priority: -100 }

    App\Exception\Handler\ExceptionHandlerRegistry:
        arguments:
            $handlers: !tagged_iterator { tag: 'app.exception_handler', default_priority_method: '' }

    # Messenger middlewares configuration
    App\Messenger\Middleware\ApiExceptionMiddleware:
        arguments:
            $logger: '@monolog.logger'
        tags: [{ name: 'messenger.bus_middleware', bus: 'messenger.bus.default', priority: 100 }]

    App\Messenger\Middleware\MessengerLoggingMiddleware:
        arguments:
            $logger: '@monolog.logger'
        tags: [{ name: 'messenger.bus_middleware', bus: 'messenger.bus.default', priority: 200 }]

    # Other services configuration
    App\Security\HashValidator:
        arguments:
            $appStoreSecret: '%env(APPSTORE_APP_SECRET)%'
    App\Factory\ShopFactory:
        arguments:
            $logger: '@monolog.logger'
    App\Service\Persistence\ShopPersistenceService:
        arguments:
            $logger: '@monolog.logger'
    App\Service\AppStoreEventProcessor:
        arguments:
            $logger: '@monolog.logger'
    App\Service\OAuth\Authentication\AuthenticationService:
        arguments:
            $logger: '@monolog.logger'

    # Registration of external services
    DreamCommerce\Component\Common\Http\GuzzleClient:

    DreamCommerce\Component\ShopAppstore\Api\Http\ShopClient:

    DreamCommerce\Component\ShopAppstore\Model\Application:
        arguments:
            $appId: '%env(APP_CLIENT)%'
            $appSecret: '%env(APP_SECRET)%'
            $appstoreSecret: '%env(APPSTORE_APP_SECRET)%'
