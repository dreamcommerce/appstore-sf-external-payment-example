{% extends 'base.html.twig' %}

{% block title %}Payment Details{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/payment-details.css') }}">
{% endblock %}
{% block body %}
<div class="payment-details-container modern">
    <h1 class="payment-details-title">Payment Details</h1>
    <div class="payment-data">
        {% if payment %}
            <div class="payment-data-box modern">
                <div class="payment-info-grid">
                    <div class="payment-info-row">
                        <span class="payment-info-label">Technical Name:</span>
                        <span class="payment-info-value">{{ payment.name }}</span>
                    </div>
                    <div class="payment-info-row">
                        <span class="payment-info-label">Visibility:</span>
                        <span class="payment-info-value">
                            <span class="badge badge-{{ payment.visible == '1' ? 'success' : 'secondary' }}">
                                {{ payment.visible == '1' ? 'Visible' : 'Hidden' }}
                            </span>
                        </span>
                    </div>
                    <div class="payment-info-row">
                        <span class="payment-info-label">Currencies:</span>
                        <span class="payment-info-value">
                            {% if payment.currencies is iterable and payment.currencies|length > 0 %}
                                <ul class="payment-currency-list">
                                    {% for currency in payment.currencies %}
                                        <li class="currency-badge">{{ currency.name }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <span class="text-muted">None</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="payment-info-row">
                        <span class="payment-info-label">Supported Currencies:</span>
                        <span class="payment-info-value">
                            {% if payment.supportedCurrencies is iterable and payment.supportedCurrencies|length > 0 %}
                                <ul class="payment-currency-list">
                                    {% for currency in payment.supportedCurrencies %}
                                        <li class="currency-badge">{{ currency.name }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <span class="text-muted">None</span>
                            {% endif %}
                        </span>
                    </div>
                    {% set translation = payment.translations[language] ?? null %}
                    {% if translation %}
                        <div class="payment-info-row">
                            <span class="payment-info-label">Title:</span>
                            <span class="payment-info-value">{{ translation.title }}</span>
                        </div>
                        <div class="payment-info-row">
                            <span class="payment-info-label">Description:</span>
                            <span class="payment-info-value">{{ translation.description }}</span>
                        </div>
                    {% endif %}
                </div>
                <div class="payment-channels-section">
                    <span class="label">Payment Channels:</span>
                    {% if channels is iterable and channels|length > 0 %}
                        <table class="table table-striped payment-channels-table modern">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>App Channel ID</th>
                                    <th>Type</th>
                                    <th>Name</th>
                                    <th>Additional Label Info</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for channel in channels %}
                                    {% set ch_translation = channel.translations[language] ?? (channel.translations|first) %}
                                    <tr>
                                        <td>{{ channel.channel_id }}</td>
                                        <td>{{ channel.application_channel_id|default('N/A') }}</td>
                                        <td><span class="badge badge-type">{{ channel.type|default('N/A') }}</span></td>
                                        <td>{{ ch_translation.name|default('N/A') }}</td>
                                        <td>{{ ch_translation.additional_label_info|default('') }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary channel-edit-btn" data-channel-id="{{ channel.channel_id }}">
                                                <i class="fa fa-edit"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger channel-delete-btn" data-channel-id="{{ channel.channel_id }}">
                                                <i class="fa fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <span class="text-muted">No channels available for this payment.</span>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="payment-data-empty">No payment data available.</div>
        {% endif %}
    </div>
    <div class="actions">
        <button type="button" class="btn btn-primary action-create-channel" id="create-channel-btn">Create new payment channel</button>
    </div>

    <!-- Modal for creating new channel -->
    <div id="create-channel-modal" class="modal">
        <div class="modal-content">
            <span class="close-create-channel">&times;</span>
            <h2>Create New Payment Channel</h2>
            <form id="create-channel-form">
                <div class="form-group">
                    <label for="application-channel-id">Application Channel ID</label>
                    <input type="text" id="application-channel-id" name="application_channel_id" required>
                </div>
                <div class="form-group">
                    <label for="channel-type">Type</label>
                    <input type="text" id="channel-type" name="type">
                </div>
                <div class="form-group">
                    <label for="channel-name">Name</label>
                    <input type="text" id="channel-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="channel-description">Additiona label info</label>
                    <textarea id="channel-description" name="description" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Create Channel</button>
                    <button type="button" class="btn btn-outline-primary cancel-create-channel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('assets/payment-details.js') }}"></script>
{% endblock %}
